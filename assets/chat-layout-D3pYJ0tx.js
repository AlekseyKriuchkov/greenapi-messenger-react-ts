import{j as s,r}from"./index-Dm6gIa3H.js";const $="_wrapper_196yf_1",v={wrapper:$},b=()=>s.jsxs("div",{className:v.wrapper,children:[s.jsx("div",{children:"Profile"}),s.jsx("div",{children:"Settings"})]}),I="_wrapper_1ekdt_1",E={wrapper:I},M="_wrapper_1g3uq_1",k="_chatList_1g3uq_9",L="_chatItem_1g3uq_16",S="_input_1g3uq_33",D="_text_1g3uq_48",h={wrapper:M,chatList:k,chatItem:L,input:S,text:D},q=({selectChat:e})=>{const[t,a]=r.useState([]),[i,l]=r.useState(""),g=r.useCallback(c=>{l(c.target.value)},[]),m=r.useCallback(c=>{if(c.key==="Enter"&&i.trim()!==""){const w=Number(i);isNaN(w)||(a(y=>[w,...y]),l(""))}},[i]),_=r.useCallback(c=>{e(c)},[e]);return s.jsxs("div",{className:h.wrapper,children:[s.jsx("input",{type:"number",className:h.input,value:i,onChange:g,onKeyDown:m,placeholder:"Enter a number"}),s.jsx("p",{className:h.text,children:"Chats"}),s.jsx("div",{className:h.chatList,children:t.map(c=>s.jsxs("div",{onClick:()=>_(c),className:h.chatItem,children:["+",c]},c))})]})},V="_wrapper_5rp4k_1",U="_header_5rp4k_8",W="_chat_5rp4k_16",P="_message_5rp4k_25",K="_inputWrapper_5rp4k_32",O="_input_5rp4k_32",d={wrapper:V,header:U,chat:W,message:P,inputWrapper:K,input:O},R="https://1103.api.green-api.com",B="/waInstance";async function j(e,t,a){const i=`${R}${B}${e}`;try{return await(await fetch(i,{method:t,headers:{"Content-Type":"application/json"},body:a?JSON.stringify(a):void 0})).json()}catch(l){console.error(l)}}const F=e=>`${e}@c.us`,C=(e,t,a)=>a?`${e.idInstance}/${t}/${e.apiTokenInstance}/${a}`:`${e.idInstance}/${t}/${e.apiTokenInstance}`,G=({contactNumber:e,userTokens:t})=>{const[a,i]=r.useState(""),[l,g]=r.useState([]),m=r.useCallback(async()=>{if(!(!a.trim()||!e||!t))try{const n={chatId:F(e),message:a},p=C(t,"sendMessage"),u=await j(p,"POST",n),o={message:a,sender:"me",id:u.idMessage};g(x=>[...x,o]),i("")}catch(n){console.error("Error sending message:",n)}},[a,e,t]),_=r.useCallback(async()=>{var n,p;if(t)try{const u=C(t,"receiveNotification"),o=await j(u,"GET");if(o!=null&&o.receiptId){const x=(p=(n=o.body.messageData)==null?void 0:n.textMessageData)==null?void 0:p.textMessage;if(x){const f={message:x,sender:o.body.senderData.senderName||"Unknown",id:o.idMessage};g(N=>[...N,f])}await c(o.receiptId)}await _()}catch(u){console.error("Error fetching message:",u)}},[]),c=r.useCallback(async n=>{if(t)try{const p=C(t,"deleteNotification",n);await j(p,"DELETE")}catch(p){console.error("Error deleting message:",p)}},[t]);r.useEffect(()=>{_()},[]);const w=r.useCallback(n=>{i(n.target.value)},[]),y=r.useCallback(async n=>{n.key==="Enter"&&a.trim()&&await m()},[a,m]);return s.jsxs("div",{className:d.wrapper,children:[s.jsx("div",{className:d.header,children:e&&`+${e}`}),s.jsx("div",{className:d.chat,children:l.map(n=>s.jsxs("span",{className:d.message,children:[s.jsxs("strong",{children:[n.sender,":"]})," ",n.message]},n.id))}),s.jsx("div",{className:d.inputWrapper,children:e&&s.jsx("input",{value:a,onChange:w,onKeyDown:y,placeholder:"Enter your message",className:d.input})})]})},z=({userTokens:e})=>{const[t,a]=r.useState(null);return s.jsxs("div",{className:E.wrapper,children:[s.jsx(b,{}),s.jsx(q,{selectChat:a}),s.jsx(G,{userTokens:e,contactNumber:t})]})};export{z as default};
